<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0
    Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions" 
      xmlns:ui="http://java.sun.com/jsf/facelets">
    <h:head></h:head>
    <h:body>
        <ui:composition > 
            <style>
                .ui-growl-item-container.ui-state-highlight {
                    border-color: red;

                }  </style>

            <p:growl id="msgs" showDetail="true" life="3000"/>

            <div align="center">
                <p:panel id="maintab" header="AVAILABLE SMS USERS::Current SMS balance:: #{userScroller.userProfile.maxTotal}" >
                    <h:form id="showusers">
                        <table align="center" style="margin-top:15px" >
                            <tr>
                                <td style="width: 200px"><h:outputLabel for="users" 
                                                                        value="User" /></td>
                                <td>   

                                    <p:selectOneMenu id="users" 
                 valueChangeListener="#{userScroller.usersValueChangeListener}"
                 value="#{userScroller.userS}">
    <f:ajax event="change" render="showusers table" />
    <f:selectItem itemLabel="Select User" itemValue="" />
    <f:selectItems value="#{sMSOut.data}" var="user" itemLabel="#{user.name}" itemValue="#{user.id}" />

  
</p:selectOneMenu>





                                </td>




                            </tr>
                        </table>
                   



                    <p:dataTable id="table" var="data" value="#{userScroller.allUsers}">
                        <p:column headerText="Username">
                            <h:outputText value="#{data.username}" />
                        </p:column>
                        <p:column headerText="SMS Per Day">
                            <h:outputText value="#{data.maxContacts}" />
                        </p:column>
                        <p:column headerText="SMS Credits">
                            <h:outputText value="#{data.smsCredits}" />
                        </p:column>
                        <p:column headerText="Alert Threshold">
                            <h:outputText value="#{data.alertThreshold}" />
                        </p:column>
                        <p:column headerText="Organization">
                            <h:outputText value="#{data.organization}" />
                        </p:column>
                        <p:column headerText="Mobile">
                            <h:outputText value="#{data.userMobile}" />
                        </p:column>
                        <p:column headerText="Email">
                            <h:outputText value="#{data.userEmail}" />
                        </p:column>
                        <p:column headerText="Group">
                            <h:outputText value="#{data.group}" />
                        </p:column>


                        <p:column headerText="Action">
                            <!--<h:form id="composition">-->

<div style="display: flex; justify-content: space-between;">
                                
                                <p:commandLink ajax="true"
                                               id="editbutton"
>

                                   <p:ajax  listener="#{userScroller.pSetCurrentItem(data)}" 
                                            update="editgroupmodal " 
                                            event="click"
                                             oncomplete="PF('editgroupmodal').show();"  
                                           />
                                    <h:graphicImage 
                                        value="resources/images/edit.gif" width="15px"   >

                                    </h:graphicImage>
                                                     <p:tooltip for="editbutton" value="Click to edit user"/>

                                </p:commandLink>
                            
                                     
                                
                                   <p:commandLink ajax="true" 
                                                  id="managecreditsbutton"
>

                                   <p:ajax  listener="#{userScroller.pSetCurrentItem(data)}" 
                                            update="editsmscredits" 
                                            event="click"
                                            
                                             oncomplete="PF('editsmscredits').show();"  
                                           />
                                    <h:graphicImage 
                                        value="resources/images/icons/credit.png" width="15px"   >

                                    </h:graphicImage>
                                                     <p:tooltip for="managecreditsbutton" value="Click to manage user credits"/>

                                </p:commandLink>


                                
                                
                                <!--start-->
                                
                                 <p:commandLink ajax="true" 
                                                id="deletebutton"
>

                                   <p:ajax  listener="#{userScroller.pSetCurrentItem(data)}" 
                                            update="deletegroupmodal" 
                                            event="click"
                                             oncomplete="PF('deletegroupmodal').show();"  
                                           />
                                    <h:graphicImage 
                                        value="resources/images/delete.gif" width="15px"   >

                                    </h:graphicImage>
       <p:tooltip for="deletebutton" value="Click to delete user"/>

                                </p:commandLink>
                                <!--stop-->
                        



                              
</div>
                        
                            
                          
                        </p:column>
 

                    </p:dataTable>
                        
                        
                        <p:panel>
                            <p:panelGrid  style="margin-right:auto; margin-left:auto;">
                                <p:outputLabel value="Assign  Alphanumeric : "></p:outputLabel>
                                <br/>
                    <p:selectOneMenu 
                        id="alphanumeric" 
                        required="true" requiredMessage="Aphanumerics Required" 
                        valueChangeListener="#{userScroller.saveOrUpdateAlpha}"
                       
                        >

                        <f:selectItem itemLabel="Select Sender ID"/>
                        <f:selectItems  value="#{userController.comboAlphanumerics}"  />
                        <p:ajax event="change" update="showusers:aplhagrid"></p:ajax>
                    </p:selectOneMenu >
                                
                    <h:panelGrid width="100%" style="margin-left:auto; margin-right:auto;" id="aplhagrid">
                        <p:dataTable rendered="#{!empty userScroller.getUserAlphas()}"
                                        value="#{userScroller.getUserAlphas()}"  
                                        var="ualpha"
                                        id="alphas"
                                        styleClass="table table-striped" 
                                        style="margin-left:auto; margin-right:auto;"

                                        >
                            <f:facet name="header">
                                <h:outputText value="Available Sender IDs" />

                            </f:facet>

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Sender ID"/>
                                </f:facet>
                                <h:outputText value="#{ualpha.alphanumeric}" />

                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Sender ID Type"/>
                                </f:facet>
                                <h:outputText value="#{ualpha.sid_type}" />
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Action"/>
                                </f:facet>

<!--                                actionListener="{userScroller.removeUserAlpha()}" -->
<!--start-->
    <p:commandLink ajax="true" 
                   id="deletealphanumeric"
>

                                   <p:ajax  listener="#{userScroller.psetCurrentAlphanumeric(ualpha.alphanumeric)}" 
                                            update="alphas,delAlpha" 
                                            event="click"
                                             oncomplete="PF('delAlpha').show()"  
                                           />
                                    <h:graphicImage 
                                        value="/resources/images/delete.gif" width="15px"   >

                                    </h:graphicImage>
                                          <p:tooltip for="deletealphanumeric" value="Click to delete alphanumeric"/>

                                </p:commandLink>
<!--stop-->

                            </p:column>

                            <f:facet name="footer">
                                

                            </f:facet>
                        </p:dataTable> 
                    </h:panelGrid>
                                
                            </p:panelGrid>
                            
                        </p:panel>
                        
 </h:form> 
  
          <p:dialog header="Edit SMS Credits" widgetVar="editsmscredits"  id="editsmscredits"  modal="true" >
              <h:form>     
                                <table align="center" style="margin-top:15px; width: 400px; border-color: white">
                                    
                                    <tr>
                                        <td><p:outputLabel value="Username:"></p:outputLabel></td>
                                        <td><p:inputText value="#{userScroller.currentItem.username}" readonly="true"></p:inputText></td>
                                    </tr>
                                      <tr>
                                        <td><p:outputLabel value="Available SMS Credits:"></p:outputLabel></td>
                                        <td><p:inputText value="#{userScroller.currentItem.smsCredits}" readonly="true"></p:inputText></td>
                                    </tr>
                                     <tr>
                                        <td><p:outputLabel value="Select Action:"></p:outputLabel></td>
                                        <td>
                                            
                                              <p:selectOneMenu id="safaricomalphanumeric" 
                                                     value="#{userScroller.currentItem.creditManageType}">
                                        <f:selectItem itemLabel="Add Credit" itemValue="add" />
                                        <f:selectItem itemLabel="Alter Credit" itemValue="update" />
                                    </p:selectOneMenu>
                                        </td>
                                    </tr>
                                     <tr>
                                        <td><p:outputLabel value="SMS Credit Value :"></p:outputLabel></td>
                                        <td><p:inputText value="#{userScroller.currentItem.creditsToManage}" ></p:inputText></td>
                                    </tr>
                                    <tr>
                                        
                                        <!--hidden-->
                                      <h:inputHidden id="secret_username" value="#{userScroller.currentItem.username}"/>
                    <h:inputHidden id="secrete_smsCredit"  value="#{userScroller.currentItem.smsCredits}"/>
                                        <!--hidden-->
                                        
                                        
                                        
                                        <td></td>
                                        <td >
                                            
                                           <p:commandButton value="execute" 
                 ajax="true"
                 update="showusers:table, msgs"
                 oncomplete="if (#{facesContext.maximumSeverity==null}) PF('editsmscredits').hide();"
>
                                               <f:actionListener binding="#{userScroller.currentItem.manageCredit()}" />
                                               <f:actionListener binding="#{userScroller.fetchAllUsers()}" />
</p:commandButton>
</td>
                                        
                                    </tr>
                                   
                                </table>
          </h:form>
                              
                                </p:dialog>            
                    
  <p:dialog header="Edit SMS User" widgetVar="editgroupmodal" id="editgroupmodal" modal="true">
      <h:form>
                                    <table align="center" style="margin-top:15px; width: 400px; border-color: white" >
                                        <tr >
                                            <td ><h:outputLabel for="username" value="Username" /></td>
                                            <td><p:inputText style="width: 150px" id="username" value="#{userScroller.currentItem.username}" 
                                                             >
                                                </p:inputText></td>
                                        </tr>

                                         <tr >
                                            <td ><h:outputLabel for="password" 
                                                                value="Password" /></td>
                                            <td><p:inputText style="width: 150px" id="password" value="#{userScroller.currentItem.password}" 
                                                           >
                                               
                                                </p:inputText></td>
                                        </tr>
                                        
                                          <tr >
                                            <td ><h:outputLabel for="organization" value="Organization" /></td>
                                            <td><p:inputText style="width: 150px" id="organization"
                                                             value="#{userScroller.currentItem.organization}" required="false" placeholder="" 
                                                              >
                                                </p:inputText></td>
                                        </tr>
                                        
                                          <tr >
                                            <td ><h:outputLabel for="mobile" value="mobile" /></td>
                                            <td><p:inputText style="width: 150px" 
                                                             id="mobile" value="#{userScroller.currentItem.userMobile}" 
                                                             required="false" placeholder=""  >
                                                </p:inputText></td>
                                        </tr>
                                          <tr >
                                            <td ><h:outputLabel for="email" value="email" /></td>
                                            <td><p:inputText style="width: 150px" id="email" value="#{userScroller.currentItem.userEmail}" 
                                                             required="false" placeholder="">
                                                
                                                </p:inputText></td>
                                        </tr>
                                        
                                          <tr >
                                            <td ><h:outputLabel for="alertthreshold" value="AlertThreshold" /></td>
                                            <td><p:inputText style="width: 150px" id="alertthreshold" value="#{userScroller.currentItem.alertThreshold}" 
                                                             required="false" placeholder="" >
                                                </p:inputText></td>
                                        </tr>
                                        
                                          <tr >
                                            <td ><h:outputLabel for="costpersms" value="Cost Per sMS" /></td>
                                            <td><p:inputText style="width: 150px" id="costpersms" value="#{userScroller.currentItem.cost_per_sms}" 
                                                             required="false" placeholder="" >
                                                </p:inputText></td>
                                        </tr>
                                        
                                          <tr >
                                            <td ><h:outputLabel for="arrears" value="Arrears" /></td>
                                            <td><p:inputText style="width: 150px" id="arrears" value="#{userScroller.currentItem.arrears}" 
                                                             required="false" placeholder="" >
                                                </p:inputText></td>
                                        </tr>
                                        
                                          <tr >
                                            <td ><h:outputLabel for="subaccount" value="Can Create Sub-Account" style="display: #{userScroller.showReseller()}" /></td>
                                            <td> <p:selectBooleanCheckbox id="subaccount"
                                                             value="#{userScroller.currentItem.createAccount}"
                                                             style="display: #{userScroller.showReseller()}"
                                                             /></td>
                                        </tr>
                                        
                                          <tr >
                                            <td ><h:outputLabel for="alert"
                                                                value="Enable Email Alert" /></td>
                                            <td> <p:selectBooleanCheckbox id="alert"
                                                             value="#{userScroller.currentItem.enableEmailAlertWhenCreditOver}"
                                                             /></td>
                                        </tr>
                                        
                                          <tr >
                                            <td ><h:outputLabel for="group" value="Group"  rendered="#{userScroller.showReseller()}"  /></td>
                                            <td> <p:selectOneMenu id="group" 
                                                     value="#{userController.alphanumeric}"  rendered="#{userScroller.showReseller()}">
                                        <f:selectItem itemLabel="Select Group" itemValue="" />
                                        <f:selectItems value="#{userController.comboGroups}" />
                                    </p:selectOneMenu></td>
                                        </tr>
                                        
                                        


                                    </table>                                      

                                    <br/>
                                    <div style="display: flex; justify-content: center; margin: 10px 10px 0px 10px">
                                       <p:commandButton style="margin-right: 10px" ajax="false"  
                 oncomplete="PF('deletegroupmodal').hide();" 
                 value="Save">
                                           <f:actionListener binding="#{userScroller.store()}" />
                                           <f:actionListener binding="#{userScroller.fetchAllUsers()}" />
</p:commandButton>

                                        <p:commandButton value="Cancel" 
                                                         onclick="PF('editgroupmodal').hide();"></p:commandButton>
                                    </div>
                                    </h:form>
                                </p:dialog> 

  <p:dialog header="Delete  SMS User" widgetVar="deletegroupmodal"  id="deletegroupmodal"  modal="true" >
                                    <h:form>
                                    <p:outputLabel value="Are you sure you want to delete `#{userScroller.currentItem.username}` sms user?"/>
                                    <br/>
                                    <div style="display: flex; justify-content: center; margin: 10px 10px 0px 10px">
                      <p:commandButton style="margin-right: 10px" ajax="false" 
                 oncomplete="PF('deletegroupmodal').hide();" 
                 value="Delete">
    <f:actionListener binding="#{userScroller.deleteUser()}" />
     <f:actionListener binding="#{userScroller.fetchAllUsers()}" />
</p:commandButton>

                                        <p:commandButton value="Cancel" onclick="PF('deletegroupmodal').hide();"></p:commandButton>
                                    </div>
                                        </h:form>
                                </p:dialog> 
                                
                    
                                
<!--start-->
<p:dialog id="delAlpha" widgetVar="delAlpha"  width="450">
        <f:facet name="header">
            <h:outputText value="Remove Sender ID" />
        </f:facet>
        <f:facet name="controls">
            <h:panelGroup>

                <h:panelGroup>
                    <h:graphicImage value="/resources/images/icons/close.png" id="del"
                                    styleClass="hidelink" />
                   
                </h:panelGroup>


            </h:panelGroup>
        </f:facet>
        <h:form>
            <p:messages style="color:red;"></p:messages>
            <h:panelGrid columns="1">
                <p:outputPanel>

                    <h:outputText value=""></h:outputText>
                    <h:inputHidden id="username" value="#{userScroller.currentItem.username}">

                    </h:inputHidden>

                    <h:outputText  value="Remove #{userScroller.currentAlphanumeric} Sender id  from #{userScroller.userS} ?"/>
                </p:outputPanel>

                <h:panelGrid  columns="2" style="margin-right:auto; margin-left:auto; text-align:center" width="100%">
                    <p:commandButton value="Remove"
                                        
                                          >
                    
                        <p:ajax listener="#{userScroller.removeUserAlpha}" oncomplete="PF('delAlpha').hide();" update="msgs,showusers:table,showusers:aplhagrid"/>
                    </p:commandButton>
                    <p:commandButton value="Cancel" onclick="PF('delAlpha').hide();" />
                </h:panelGrid>
            </h:panelGrid>
        </h:form>
    </p:dialog>



<!--stop-->


                </p:panel>
            </div>
        </ui:composition>
    </h:body>
</html> 