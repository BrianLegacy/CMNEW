<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0
    Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">
    <h:head></h:head>
    <h:body>
        <ui:composition > 
            <style>
                .ui-growl-item-container.ui-state-highlight {
                    border-color: red;

                }
                .formgrid {
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 20px;
                    margin: 20px;
                }
                .field {
                    display: flex;
                    flex-direction: column;
                    margin-bottom: 15px;
                }
                .field-full {
                    grid-column: span 2;
                }
                .align-center {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                }

                .ui-panelgrid-content{
                    border: none;
                }


            </style>

            <p:growl id="msgs" showDetail="true" life="3000"/>
            <div align="center">
                <p:panel id="maintab" header="AVAILABLE CALLBACKS" >
                    <h:form id="callbacks">
                        <p:commandButton value="Create New Callback" onclick="PF('createCallbackDialog').show();" 
                                         style="margin-bottom: 1rem;
                                         padding: 0.5rem 0.5rem 0.5rem 2.5rem;
                                         background-image: url('#{resource['images/addcallback.png']}');
                                         background-size: 1.5rem 1.5rem;
                                         background-repeat: no-repeat;
                                         background-position:  0.5rem center;" ajax="true"/>

                        <p:dataTable id ="table" var="data" value="#{callbackController.callbacks}"
                                     rows="10"
                                     rowsPerPageTemplate="5, 10, 15"
                                     paginator="true" paginatorPosition="bottom"
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     currentPageReportTemplate="{totalRecords} records"
                                     >
                            <p:column headerText="Username" filterBy="#{data.username}">
                                <h:outputText value="#{data.username}"/>
                            </p:column>

                            <p:column headerText="Codes">
                                <h:outputText  value="#{data.ussd_assigned_code}" />
                            </p:column>

                            <p:column headerText="Call back Url">
                                <h:outputText value="#{data.callback_url}" />
                            </p:column>
                            <p:column headerText="Testbed Numbers">
                                <h:outputText value="#{data.testbednumbers}" />
                            </p:column>
                            <p:column headerText="Testbed">
                                <h:outputText value="#{data.testbed==true?'Active':'Inactive'}" />
                            </p:column>
                            <p:column headerText="Status" filterBy="#{data.real_status}">
                                <h:outputText  value="#{data.real_status}" />
                            </p:column>
                            <p:column headerText="Due Date">
                                <h:outputText  value="#{data.duedate}" />
                            </p:column>
                            <p:column headerText="Disconnect Date">
                                <h:outputText  value="#{data.disconnectDate}" />
                            </p:column>
                            <p:column headerText="Action">
                                <p:commandButton style="padding: .3em 1em;" 
                                                 id="editbutton"
                                                 update="editgroupmodal"
                                                 oncomplete="PF('editgroupmodal').show();"
                                                 icon="fa fa-pencil-square-o">
                                    <p:ajax listener="#{callbackController.setCurrentUrl(data)}" 
                                            update="editgroupmodal"
                                            event="click"/>
                                    <p:tooltip for="editbutton" value="Click to edit callback"/>
                                </p:commandButton>

                                <p:commandButton style="padding: .3em 1em;" 
                                                 id="deletebutton"
                                                 update="deletegroupmodal"
                                                 oncomplete="PF('deletegroupmodal').show();"
                                                 icon="fa fa-trash">
                                    <p:ajax listener="#{callbackController.setCurrentUrl(data)}" 
                                            update="deletegroupmodal"
                                            event="click"/>
                                    <p:tooltip for="deletebutton" value="Click to delete callback"/>
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>
                    </h:form>
                </p:panel>
                <h:outputScript>
                    function toggleTestbedNumbersRequirement() {
                    var testbedCheckbox = document.getElementById('testbed');
                    var testbedNumbersInput = document.getElementById('testbednumbers');
                    if (testbedCheckbox.checked) {
                    testbedNumbersInput.setAttribute('required', 'true');
                    } else {
                    testbedNumbersInput.removeAttribute('required');
                    }
                    }
                </h:outputScript>

                <!--start create callback dialog-->
                <p:dialog header="Create New Callback" widgetVar="createCallbackDialog" id="createCallbackDialog" modal="true" width="750">
                    <h:form id="createCallbackForm">
                        <p:panelGrid columns="2">
                            <p:panelGrid columns="2">
                                <p:outputLabel for="users" value="User"/>
                                <p:selectOneMenu id="users" value="#{callbackController.username}" filter="true" style=" min-width:100px !important">
                                    <f:ajax event="change" render="createCallbackForm"/>
                                    <f:selectItem itemLabel="Select User" itemValue=""/>
                                    <f:selectItems value="#{sMSOut.data}"/>
                                </p:selectOneMenu>

                                <p:outputLabel for="code" value="Code"/>
                                <p:inputText id="code" value="#{callbackController.newUrl.ussd_assigned_code}" required="true" placeholder=""
                                             requiredMessage="Enter Code">
                                    <f:ajax event="blur" render="msgs"/>
                                </p:inputText>
                                <p:outputLabel for="callbackurl" value="CallBack Url"/>
                                <p:inputText id="callbackurl" value="#{callbackController.newUrl.callback_url}" required="true" placeholder=""
                                             requiredMessage="Enter Url">
                                    <f:ajax event="blur" render="msgs"/>
                                </p:inputText>

                                <p:panelGrid columns="2">
                                    <p:outputLabel for="status" value="Status" style="margin-left: 2rem !important; margin-top: 1rem !important"/>
                                    <p:selectOneMenu id="status" value="#{callbackController.newUrl.status}"   style="margin-left: 1.5rem !important">
                                        <f:selectItem  itemLabel="Select One" />
                                        <f:selectItem itemLabel="Active" itemValue="true"/>
                                        <f:selectItem itemLabel="Inactive" itemValue="false"/>
                                    </p:selectOneMenu>
                                    <p:outputLabel for="testbed" value="Testbed" style="margin-left: 2rem !important; margin-top: 1rem !important"/>
                                    <p:selectOneMenu id="testbed" value="#{callbackController.newUrl.testbed}" style="margin-left: 1.5rem !important">
                                        <f:selectItem  itemLabel="Select One" />
                                        <f:selectItem itemLabel="Active" itemValue="true"/>
                                        <f:selectItem itemLabel="Inactive" itemValue="false"/>
                                    </p:selectOneMenu>
                                   
                                </p:panelGrid>

                            </p:panelGrid>

                            <p:panelGrid columns="2">
                                <p:outputLabel for="duedate" value="Due Date: "/>
                                <p:calendar id="duedate" pattern="yyyy-MM-dd"  value="#{callbackController.newUrl.duedate}" />
                                <p:outputLabel for="disconnectdate" value="Disconnect Date"/>
                                <p:calendar id="disconnectdate" value="#{callbackController.newUrl.disconnectDate}" pattern="yyyy-MM-dd" />
                                <p:outputLabel for="testbednumbers" value="Testbed Numbers"/>
                                <p:inputTextarea id="testbednumbers" value="#{callbackController.newUrl.testbednumbers}"  placeholder="">
                                    <f:ajax event="blur" render="msgs"/>
                                </p:inputTextarea>

                            </p:panelGrid>

                            <p:panelGrid columns="1">
                                <p:commandButton value="Save" icon="fa fa-save"
                                                 action="#{callbackController.createCallback()}"
                                                 update=":callbacks:table :msgs"
                                                 oncomplete="PF('createCallbackDialog').hide();" />
                            </p:panelGrid>

                        </p:panelGrid>
                    </h:form>
                </p:dialog>
                <!--end create callback dialog-->

                <p:dialog header="Edit Callback" widgetVar="editgroupmodal" id="editgroupmodal" modal="true" width="750">
                    <h:form id ="editCallback">
                        <p:panelGrid columns="2" style=" padding: 0; background: green">
                            <p:panelGrid  columns="2" style="">
                                <p:outputLabel for="userid" value="User ID: " style="margin-right: 0; width: 150px;"/>
                                <p:inputText id="userid" value="#{callbackController.currentUrl.getUserid()}" disabled="true" readonly="true"/>

                                <p:outputLabel for="username" value="Username: " style="margin-right: 0; width: 150px;"/>
                                <p:inputText id="username" value="#{callbackController.currentUrl.username}" disabled="true" readonly="true"/>   

                                <p:outputLabel for="code" value="Code: " style="margin-right: 10px; width: 150px;"/>
                                <p:inputText id="code" value="#{callbackController.currentUrl.ussd_assigned_code}" disabled="true" readonly="true"/>
                                <p:outputLabel for="callback_" value="Callback: "  style="margin-right: 10px; width: 150px;"/>
                                <p:inputText id="callback_" value="#{callbackController.currentUrl.callback_url}"/>
                                <p:outputLabel for="status" value="Status: " style="margin-right: 10px; width: 150px;"/>
                                <p:selectOneMenu id="status" value="#{callbackController.currentUrl.status}">
                                    <f:selectItem itemLabel="Active" itemValue="true"/>
                                    <f:selectItem itemLabel="Inactive" itemValue="false"/>
                                </p:selectOneMenu>
                                <p:outputLabel for="testbed" value="Testbed: "  style="margin-right: 10px; width: 150px;"/>
                                <p:selectOneMenu id="testbed" value="#{callbackController.currentUrl.testbed}">
                                    <f:selectItem itemLabel="Active" itemValue="true"/>
                                    <f:selectItem itemLabel="Inactive" itemValue="false"/>
                                </p:selectOneMenu>
                            </p:panelGrid>
                            <p:panelGrid columns="2">
                                <p:outputLabel for="testmobilestextarea" value="Testbed Mobiles"  style="margin-right: 10px; width: 150px;"/>
                                <p:inputTextarea  id="testmobilestextarea" value="#{callbackController.currentUrl.testbednumbers}"/>
                                <p:outputLabel for="duedate" value="Due Date"  style="margin-right: 10px; width: 150px;"/>
                                <p:calendar id="duedate" pattern="yyyy-MM-dd" value="#{callbackController.currentUrl.duedate}"  mode="Popup"/>
                                <p:outputLabel for="disconnectdate" value="Disconnect Date"  style="margin-right: 10px; width: 150px;"/>
                                <p:calendar id="disconnectdate" pattern="yyyy-MM-dd" value="#{callbackController.currentUrl.disconnectDate}" mode="Popup"/>
                            </p:panelGrid>
                        </p:panelGrid>
                        <p:panelGrid columns="2">
                            <p:commandButton value="Save"
                                             action="#{callbackController.editCallback()}"
                                             update=":callbacks:table :msgs"
                                             oncomplete="PF('editgroupmodal').hide();"/>
                            <p:commandButton value="Cancel" onclick="PF('editgroupmodal').hide();"/>
                        </p:panelGrid>
                    </h:form>
                </p:dialog> 

                <p:dialog header="Delete  CallBack" widgetVar="deletegroupmodal"  id="deletegroupmodal"  modal="true" >
                    <h:form>

                        <p:outputLabel value="Are you sure you want to delete callBack '#{callbackController.currentUrl.callback_url}' ? Note: You cannot undo."/>
                        <br/>
                        <div style="display: flex; justify-content: center; margin: 10px 10px 0px 10px">

                            <p:commandButton  style="margin-right: 10px" 
                                              value="Delete"
                                              action="#{callbackController.deleteCallback()}"
                                              update=":callbacks:table :msgs"
                                              oncomplete="PF('deletegroupmodal').hide();" />

                            <p:commandButton value="Cancel" onclick="PF('deletegroupmodal').hide();"></p:commandButton>
                        </div>
                    </h:form>
                </p:dialog> 

            </div>
        </ui:composition>
    </h:body>
</html> 